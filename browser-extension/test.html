<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BUTLER Extension Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #E8F4FD 0%, #FAF7F2 100%);
    }
    
    .test-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 4px 16px rgba(74, 144, 226, 0.15);
    }
    
    h1 {
      color: #4A90E2;
      text-align: center;
    }
    
    .status {
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: 600;
    }
    
    .status.success {
      background: #D4EDDA;
      color: #155724;
      border: 1px solid #C3E6CB;
    }
    
    .status.error {
      background: #F8D7DA;
      color: #721C24;
      border: 1px solid #F5C6CB;
    }
    
    .status.pending {
      background: #FFF3CD;
      color: #856404;
      border: 1px solid #FFEAA7;
    }
    
    button {
      background: linear-gradient(135deg, #4A90E2 0%, #5CA3E8 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .test-steps {
      background: #F5E6D3;
      padding: 16px;
      border-radius: 8px;
      margin: 16px 0;
    }
    
    .test-steps ol {
      margin: 10px 0 0 20px;
    }
    
    .test-steps li {
      margin: 8px 0;
    }
    
    code {
      background: #E8D7C3;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <h1>üçî BUTLER Extension Test Page</h1>
  
  <div class="test-card">
    <h2>Extension Status</h2>
    <div id="extensionStatus" class="status pending">‚è≥ Checking extension...</div>
    <button onclick="checkExtension()">Recheck Extension</button>
  </div>
  
  <div class="test-card">
    <h2>Quick Tests</h2>
    
    <div class="test-steps">
      <strong>Test 1: Open Side Panel</strong>
      <ol>
        <li>Click the button below</li>
        <li>Side panel should open on the right</li>
        <li>You should see the chat interface</li>
      </ol>
    </div>
    <button onclick="openSidePanel()">üîπ Open Side Panel</button>
    
    <div class="test-steps">
      <strong>Test 2: Search for Food</strong>
      <ol>
        <li>Make sure API key is configured in settings</li>
        <li>Open side panel</li>
        <li>Type: <code>"Find best pizza near me"</code></li>
        <li>Should see Google search results</li>
      </ol>
    </div>
    
    <div class="test-steps">
      <strong>Test 3: Order Flow</strong>
      <ol>
        <li>After seeing search results, click "Order Now"</li>
        <li>Restaurant page opens in new tab</li>
        <li>Add items to cart manually</li>
        <li>Return to side panel, type: <code>"proceed"</code></li>
        <li>Extension clicks checkout automatically</li>
      </ol>
    </div>
  </div>
  
  <div class="test-card">
    <h2>Configuration Check</h2>
    <div id="configStatus" class="status pending">‚è≥ Checking configuration...</div>
    <button onclick="checkConfig()">Check Config</button>
    <button onclick="openSettings()">‚öôÔ∏è Open Settings</button>
  </div>
  
  <div class="test-card">
    <h2>Console Output</h2>
    <div id="consoleOutput" style="background: #2C3E50; color: #ECF0F1; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
      Extension logs will appear here...
    </div>
    <button onclick="clearConsole()">Clear Console</button>
  </div>
  
  <div class="test-card">
    <h2>Troubleshooting</h2>
    <div class="test-steps">
      <strong>If extension isn't working:</strong>
      <ol>
        <li>Go to <code>chrome://extensions/</code></li>
        <li>Find "BUTLER"</li>
        <li>Click "Reload" (üîÑ icon)</li>
        <li>Check for errors in "Errors" section</li>
        <li>Come back to this page and recheck</li>
      </ol>
    </div>
    
    <div class="test-steps">
      <strong>Common Issues:</strong>
      <ul>
        <li><strong>Side panel won't open:</strong> Make sure you're using Chrome 114+</li>
        <li><strong>Search returns no results:</strong> Check API key in settings</li>
        <li><strong>"Connection error":</strong> Extension needs to be reloaded</li>
        <li><strong>Checkout doesn't work:</strong> Platform UI may have changed</li>
      </ul>
    </div>
  </div>
  
  <script>
    let logCount = 0;
    
    function log(message, type = 'info') {
      const output = document.getElementById('consoleOutput');
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
      const color = type === 'error' ? '#E74C3C' : type === 'success' ? '#2ECC71' : '#3498DB';
      
      output.innerHTML += `<div style="color: ${color}; margin: 4px 0;">[${timestamp}] ${icon} ${message}</div>`;
      output.scrollTop = output.scrollHeight;
      logCount++;
    }
    
    function clearConsole() {
      document.getElementById('consoleOutput').innerHTML = 'Console cleared...\n';
      logCount = 0;
    }
    
    async function checkExtension() {
      log('Checking extension status...');
      const statusDiv = document.getElementById('extensionStatus');
      
      try {
        const response = await chrome.runtime.sendMessage({ type: 'GET_STATUS' });
        
        if (response && response.success) {
          statusDiv.className = 'status success';
          statusDiv.innerHTML = '‚úÖ Extension is working!<br>' +
            `API Initialized: ${response.data.isInitialized ? '‚úÖ' : '‚ùå'}<br>` +
            `API Key Configured: ${response.data.hasApiKey ? '‚úÖ' : '‚ùå'}`;
          log('Extension status check: SUCCESS', 'success');
        } else {
          throw new Error('Invalid response');
        }
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = '‚ùå Extension not responding<br>' +
          'Make sure the extension is loaded and enabled';
        log('Extension status check: FAILED - ' + error.message, 'error');
      }
    }
    
    async function checkConfig() {
      log('Checking configuration...');
      const statusDiv = document.getElementById('configStatus');
      
      try {
        const settings = await chrome.storage.sync.get(['apiKey', 'location', 'preferences']);
        
        const hasApiKey = settings.apiKey && settings.apiKey.length > 0;
        const hasLocation = settings.location && settings.location.length > 0;
        
        statusDiv.className = hasApiKey ? 'status success' : 'status error';
        statusDiv.innerHTML = 
          `API Key: ${hasApiKey ? '‚úÖ Configured' : '‚ùå Missing'}<br>` +
          `Location: ${hasLocation ? '‚úÖ ' + settings.location : '‚ö†Ô∏è Not set'}<br>` +
          `Dietary: ${settings.preferences?.dietary || 'None'}`;
        
        if (!hasApiKey) {
          log('Configuration check: Missing API key', 'error');
        } else {
          log('Configuration check: OK', 'success');
        }
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = '‚ùå Could not check config: ' + error.message;
        log('Configuration check: ERROR - ' + error.message, 'error');
      }
    }
    
    async function openSidePanel() {
      log('Opening side panel...');
      try {
        const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
        await chrome.sidePanel.open({ windowId: tab.windowId });
        log('Side panel opened successfully', 'success');
      } catch (error) {
        log('Failed to open side panel: ' + error.message, 'error');
        alert('Failed to open side panel. Make sure you are using Chrome 114 or later.');
      }
    }
    
    function openSettings() {
      log('Opening settings page...');
      chrome.runtime.openOptionsPage();
    }
    
    // Auto-check on load
    setTimeout(() => {
      checkExtension();
      checkConfig();
    }, 500);
    
    // Listen for messages from extension
    if (chrome.runtime) {
      chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
        log('Received message: ' + JSON.stringify(message));
      });
    }
  </script>
</body>
</html>
